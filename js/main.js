tableData = [{"goal": 110000, "pledged": 114976, "project name": "Sondheim 85th birthday gala at Theatre Royal Drury Lane", "city": "London", "country": "GB", "creator": "Sondheim 85th Birthday Gala", "category": "Musical", "backers": 334, "Link": "https://www.kickstarter.com/projects/281141563/sondheim-85th-birthday-gala-at-theatre-royal-drury?ref=category"}, {"goal": 100000, "pledged": 111194, "project name": "doppel - performance-enhancing wearable technology", "city": "London", "country": "GB", "creator": "Team Turquoise", "category": "Wearables", "backers": 820, "Link": "https://www.kickstarter.com/projects/1799505246/doppel-a-new-breed-of-wearable-technology-to-set-y?ref=category"}, {"goal": 600000, "pledged": 672447.28, "project name": "LUNAR MISSION ONE: A new lunar mission for everyone.", "city": "London", "country": "GB", "creator": "Lunar Missions Ltd", "category": "Space Exploration", "backers": 7297, "Link": "https://www.kickstarter.com/projects/lunarmissionone/lunar-mission-one-a-new-lunar-mission-for-everyone?ref=category"}, {"goal": 100000, "pledged": 177277, "project name": "Flare Audio - a revolution in pure sound IEM earphones", "city": "Brighton and Hove City", "country": "GB", "creator": "Flare Audio", "category": "Sound", "backers": 1260, "Link": "https://www.kickstarter.com/projects/584645150/flare-audio-a-revolution-in-pure-sound?ref=category"}, {"goal": 350000, "pledged": 493795.42, "project name": "Next Generation LiveCode (Open Source)", "city": "Edinburgh", "country": "GB", "creator": "RunRev Ltd", "category": "Software", "backers": 3342, "Link": "https://www.kickstarter.com/projects/1755283828/open-source-edition-of-livecode?ref=category"}, {"goal": 100000, "pledged": 114368.2, "project name": "Brewbot: The Smart Brewing Appliance", "city": "Belfast", "country": "GB", "creator": "Cargo", "category": "Hardware", "backers": 381, "Link": "https://www.kickstarter.com/projects/cargo/brewbot-the-smart-brewing-appliance?ref=category"}, {"goal": 100000, "pledged": 116930, "project name": "AuraVisor: the future of VR is wire free. the future is now.", "city": "North Yorkshire", "country": "GB", "creator": "James Talbot", "category": "Hardware", "backers": 684, "Link": "https://www.kickstarter.com/projects/1714346163/auravisor-virtual-reality-head-mounted-computer?ref=category"}, {"goal": 100000, "pledged": 282048, "project name": "Realiser A16: real 3D audio headphone processor", "city": "Bangor", "country": "GB", "creator": "Smyth Research", "category": "Hardware", "backers": 330, "Link": "https://www.kickstarter.com/projects/1959366850/realiser-a16-real-3d-audio-headphone-processor?ref=category"}, {"goal": 100000, "pledged": 113555.38, "project name": "Hookpod - Saving the Albatross from Extinction", "city": "Devon", "country": "GB", "creator": "Becky Ingham", "category": "Gadgets", "backers": 649, "Link": "https://www.kickstarter.com/projects/hookpod/hookpod-saving-the-albatross-from-extinction?ref=category"}, {"goal": 100000, "pledged": 280891, "project name": "Robox : Desktop 3D Printer and Micro-Manufacturing Platform", "city": "Portishead", "country": "GB", "creator": "C Enterprise (UK) Ltd.", "category": "3D Printing", "backers": 435, "Link": "https://www.kickstarter.com/projects/robox/robox-desktop-3d-printer-and-micro-manufacturing-p?ref=category"}, {"goal": 175000, "pledged": 2090104.1, "project name": "Yooka-Laylee - A 3D Platformer Rare-vival!", "city": "Derby", "country": "GB", "creator": "Playtonic Games", "category": "Video Games", "backers": 73206, "Link": "https://www.kickstarter.com/projects/playtonic/yooka-laylee-a-3d-platformer-rare-vival?ref=category"}, {"goal": 100042, "pledged": 140481.1, "project name": "Maia", "city": "Oxford", "country": "GB", "creator": "Simon Roth", "category": "Video Games", "backers": 8115, "Link": "https://www.kickstarter.com/projects/simonroth/maia?ref=category"}, {"goal": 150000, "pledged": 160055.85, "project name": "Sui Generis", "city": "London", "country": "GB", "creator": "Bare Mettle Entertainment", "category": "Video Games", "backers": 6931, "Link": "https://www.kickstarter.com/projects/1473965863/sui-generis?ref=category"}, {"goal": 450000, "pledged": 526563.49, "project name": "Project GODUS", "city": "Guildford", "country": "GB", "creator": "22cans", "category": "Video Games", "backers": 17184, "Link": "https://www.kickstarter.com/projects/22cans/project-godus?ref=category"}, {"goal": 1250000, "pledged": 1578316.08, "project name": "Elite: Dangerous", "city": "Cambridge", "country": "GB", "creator": "Frontier Developments", "category": "Video Games", "backers": 25681, "Link": "https://www.kickstarter.com/projects/1461411552/elite-dangerous?ref=category"}, {"goal": 100000, "pledged": 317281.67, "project name": "Battalion 1944 (PC/XB1/PS4)", "city": "Derby", "country": "GB", "creator": "Bulkhead Interactive", "category": "Video Games", "backers": 10096, "Link": "https://www.kickstarter.com/projects/bulkheadinteractive/battalion-1944-pc-xb1-ps4?ref=category"}, {"goal": 100000, "pledged": 126447.64, "project name": "Knights and Bikes", "city": "London", "country": "GB", "creator": "Foam Sword", "category": "Video Games", "backers": 4796, "Link": "https://www.kickstarter.com/projects/foamsword/knights-and-bikes?ref=category"},  {"goal": 150000, "pledged": 211371.5, "project name": "War for the Overworld", "city": "Brighton and Hove City", "country": "GB", "creator": "Subterranean Games", "category": "Video Games", "backers": 8351, "Link": "https://www.kickstarter.com/projects/subterraneangames/war-for-the-overworld?ref=category"}, {"goal": 100000, "pledged": 100425, "project name": "MMA Federation", "city": "London", "country": "GB", "creator": "Mixed Martial Mobile, Ltd.", "category": "Video Games", "backers": 159, "Link": "https://www.kickstarter.com/projects/186837350/mma-federation?ref=category"}, {"goal": 150000, "pledged": 168360.43, "project name": "Fabulous Beasts - a new kind of game", "city": "London", "country": "GB", "creator": "Sensible Object", "category": "Tabletop Games", "backers": 2224, "Link": "https://www.kickstarter.com/projects/sensibleobject/fabulous-beasts-a-new-kind-of-game?ref=category"}, {"goal": 100000, "pledged": 102334, "project name": "Fine dining restaurant with a relaxed atmosphere", "city": "Warwickshire", "country": "GB", "creator": "Paul Foster", "category": "Restaurants", "backers": 605, "Link": "https://www.kickstarter.com/projects/712997218/fine-dining-restaurant-with-a-relaxed-atmosphere?ref=category"}, {"goal": 100000, "pledged": 103915, "project name": "Burnt Truffle from the team behind Sticky Walnut", "city": "Hoole", "country": "GB", "creator": "Gary Usher", "category": "Restaurants", "backers": 891, "Link": "https://www.kickstarter.com/projects/1158079571/burnt-truffle-from-the-team-behind-sticky-walnut?ref=category"}, {"goal": 100000, "pledged": 100358.5, "project name": "BO66Y THE MOVIE - The Bobby Moore documentary", "city": "London", "country": "GB", "creator": "Matthew Lorenzo", "category": "Documentary", "backers": 352, "Link": "https://www.kickstarter.com/projects/1380759248/bo66y-the-movie-the-bobby-moore-documentary?ref=category"}, {"goal": 100000, "pledged": 114000, "project name": "BREXIT THE MOVIE", "city": "London", "country": "GB", "creator": "Brexit The Movie", "category": "Documentary", "backers": 1685, "Link": "https://www.kickstarter.com/projects/brexitthemovie/brexit-the-movie?ref=category"}, {"goal": 100000, "pledged": 107403.69, "project name": "As It Occurs To Me", "city": "London", "country": "GB", "creator": "Richard Herring", "category": "Comedy", "backers": 3736, "Link": "https://www.kickstarter.com/projects/467836598/as-it-occurs-to-me?ref=category"}, {"goal": 100000, "pledged": 107684, "project name": "Adaptalux: An Adaptable Miniature Lighting Studio", "city": "London", "country": "GB", "creator": "Adaptalux Ltd.", "category": "Product Design", "backers": 540, "Link": "https://www.kickstarter.com/projects/1447024032/adaptalux-an-adaptable-miniature-lighting-studio?ref=category"}, {"goal": 380000, "pledged": 383623, "project name": "The Barisieur: Designer Coffee & Tea Alarm Clock", "city": "London", "country": "GB", "creator": "Barisieur Ltd.", "category": "Product Design", "backers": 1186, "Link": "https://www.kickstarter.com/projects/393281213/the-barisieur-designer-coffee-and-tea-alarm-clock?ref=category"}, {"goal": 100000, "pledged": 107950, "project name": "The Vamp Stereo + Speaker \u00e2\u20ac\u201c Bring Back The Sound", "city": "London", "country": "GB", "creator": "Paul Cocksedge + Paul Cocksedge Studio\u00e2\u201e\u00a2", "category": "Product Design", "backers": 1771, "Link": "https://www.kickstarter.com/projects/1238747394/the-vamp-stereo-speaker-bring-back-the-sound?ref=category"}, {"goal": 175000, "pledged": 340141.59, "project name": "The FreedMan Chair - A better way to sit.", "city": "London", "country": "GB", "creator": "Simon Freedman", "category": "Product Design", "backers": 1067, "Link": "https://www.kickstarter.com/projects/929020713/the-freedman-chair-a-better-way-to-sit?ref=category"}, {"goal": 100000, "pledged": 123577.99, "project name": "Bring Ai Weiwei's Tree sculptures to London's Royal Academy", "city": "London", "country": "GB", "creator": "Royal Academy of Arts", "category": "Sculpture", "backers": 1319, "Link": "https://www.kickstarter.com/projects/royalacademy/bring-ai-weiweis-tree-sculptures-to-londons-royal?ref=category"}, {"goal": 100000, "pledged": 377952.19, "project name": "Sunless Skies - the sequel to Sunless Sea", "city": "London", "country": "GB", "creator": "Failbetter Games", "category": "Video Games", "backers": 11739, "Link": "https://www.kickstarter.com/projects/failbetter/sunless-skies-the-sequel-to-sunless-sea?ref=category"}, {"goal": 100000, "pledged": 362307, "project name": "Joto - a robotic drawing board", "city": "London", "country": "GB", "creator": "Those", "category": "Hardware", "backers": 1836, "Link": "https://www.kickstarter.com/projects/joto/joto-the-first-connected-display-that-draws-with-a?ref=category"}, {"goal": 100000, "pledged": 111563.7, "project name": "Beyond Borders - A Film Celebrating Global Diversity", "city": "London", "country": "GB", "creator": "Louis Cole", "category": "Documentary", "backers": 1666, "Link": "https://www.kickstarter.com/projects/1349068120/beyond-borders-a-film-celebrating-unity?ref=category"}, {"goal": 200000, "pledged": 208956, "project name": "Wreckfish... maybe?", "city": "Liverpool", "country": "GB", "creator": "Gary Usher", "category": "Restaurants", "backers": 1522, "Link": "https://www.kickstarter.com/projects/1357125502/wreckfish-maybe?ref=category_newest"}, {"goal": 250000, "pledged": 723390, "project name": "ZX Spectrum Next", "city": "London", "country": "GB", "creator": "Henrique Olifiers", "category": "Hardware", "backers": 3113, "Link": "https://www.kickstarter.com/projects/1835143999/zx-spectrum-next?ref=category_newest"}, {"goal": 100000, "pledged": 128961, "project name": "Codlo\u00c2\u00ae: simple & compact home sous-vide cooking", "city": "London", "country": "GB", "creator": "Grace Lee", "category": "Food", "backers": 1139, "Link": "https://www.kickstarter.com/projects/codlo/codlo-a-powerful-compact-controller-for-sous-vide?ref=category_newest"}]

var succesfullData = "";

fetch('https://cors.io/?http://danpopoutanu.ro/Crowdfunding/website/data/results.json')
  .then(response => response.json())
    .then(data => {
     successfulData = data;
    // Here's a list of successful projects!
   createTabel(data);
});


function createTabel(data) {
    $("#example-table").tabulator({
            data:data,
            layout:"fitData",
    //set initial table data

      columns:[
        {title:"Name", field:"project name", sortable:true, width:400},  
        {title:"Goal", field:"goal",formatter:"money", sortable:true,formatterParams:{symbol:"£",precision:"0"},  sorter:"number"},
        {title:"Gathered", field:"pledged",formatter:"money",formatterParams:{symbol:"£",precision:"0"},  sorter:"number"},
        {title:"City", field:"city", sortable:true},
        {title:"Creator", field:"creator", sortable:true},
      {title:"Date", field:"duration", formatter:function(cell, formatterParams){
        //cell - the cell component
        //formatterParams - parameters set for the column
        return Math.round((cell.getValue() / (3600*24))) + " days"; //return the contents of the cell;
    },
}
      ],
        rowFormatter: function(row){
            
          var data = row.getData();
            if(data.pledged >= '1000000'){
                row.getElement().addClass("positive");
            }
        },
        rowClick:function(e, row, data){
            var data = row.getData();
            if (confirm('You are about to acces the Kickstarter page for this project, Are you sure ?')) {
                 location.href=data.Link;
            }
        },
    });
    
    
    CityList = {};
    var object = [];
    function getData(){
        console.log(object);
        tableData.forEach(function(i){
            getCoords(i.city);
        })
        setTimeout(function() {
        }, 1000);
    };
    
	getData();

    function getCoords(name){
        $.get("http://maps.googleapis.com/maps/api/geocode/json?address="+name+"&sensor=false", function(data){
			if (data.results) {
				//if the same coordinates occur, increase count
				var coords = data.results[0].geometry.location.lat + ', ' + data.results[0].geometry.location.lng
				if (coords in CityList){
					CityList[coords] += 1;
				} else {
					CityList[coords] = 1;
				}
			}
            object = createDataForHeatMap(CityList)
        })
    }
    
    function createDataForHeatMap(cityList) {
        var dataHM = []
        for (var coords in cityList) {
            var lat = coords.split(', ')[0]
            var long = coords.split(', ')[1]
            dataHM.push({lat: lat, lng : long, count: cityList[coords]})
        }
        return dataHM;
    }
    
    function getCities(){
            object = createDataForHeatMap(citylist);
        };
    function myMap() {
		
		setTimeout(function() {
			var map = new google.maps.Map(document.getElementById('map'), {
			  zoom: 5,
			  center: {lat: 51.508742, lng: -0.120850}
			});

			// Construct the circle for each value in citymap.
			// Note: We scale the area of the circle based on the population.
			for (var i in object) {
				var city = object[i]
				// console.log(city.lat + " " + city.lng + " " + city.count)
				// Add the circle for this city to the map.
				var cityCircle = new google.maps.Circle({
					strokeColor: '#FF0000',
					strokeOpacity: 0.8,
					strokeWeight: 2,
					fillColor: '#FF0000',
					fillOpacity: 0.35,
					map: map,
					center: new google.maps.LatLng(city.lat, city.lng),
					radius: Math.sqrt(city.count) * 10000
				});
			}
        }, 1000);
		
		
        /*var mapProp= {
            
            center:new google.maps.LatLng(51.508742,-0.120850),
            zoom:5,
		};
        var map=new google.maps.Map(document.getElementById("map"),mapProp);
        var city = new google.maps.LatLng(52.395715,4.888916);
        var myCity = new google.maps.Circle({
            center: new google.maps.LatLng(getData()),
            radius: 30000,
            strokeColor: "#0000FF",
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: "#00ff00",
            fillOpacity: 0.4
          });
        myCity.setMap(map);*/
    }
	setTimeout(myMap(), 2000);
    //myMap();
//    // Heatmap
//    // don't forget to add gmaps-heatmap.js
//    var myLatlng = new google.maps.LatLng(53.508742,-1.120850);
//    // map options,
//    var myOptions = {
//      zoom: 6,
//      center: myLatlng
//    };
//    // standard map
//    map = new google.maps.Map(document.getElementById("map"), myOptions);
//    // heatmap layer
//    heatmap = new HeatmapOverlay(map, 
//      {
//        // radius should be small ONLY if scaleRadius is true (or small radius is intended)
//         radius: 0.4,
//        //opacity:.8,
//        maxOpacity: .9,
//        minOpacity: .1,
//        blur: 1,
//        // scales the radius based on map zoom
//        "scaleRadius": true, 
//        // if set to false the heatmap uses the global maximum for colorization
//        // if activated: uses the data maximum within the current map boundaries 
//        //   (there will always be a red spot with useLocalExtremas true)
//        "useLocalExtrema": false,
//        // which field name in your data represents the latitude - default "lat"
//        latField: 'lat',
//        // which field name in your data represents the longitude - default "lng"
//        lngField: 'lng',
//        // which field name in your data represents the data value - default "value"
//        valueField: 'count',
//      });    
    
    
    

    

};

    dataset2={"children":[]};
    tableData.forEach (function(i){
    dataset2.children.push({'Name':i["project name"],'Count':i.pledged});
        return dataset2;
    });

// dataset = {
//            "children": [{"Name":"Olives","Count":4319},
//                {"Name":"Tea","Count":4159},
//                {"Name":"Mashed Potatoes","Count":2583},
//                {"Name":"Boiled Potatoes","Count":2074},
//                {"Name":"Milk","Count":1894},
//                {"Name":"Chicken Salad","Count":1809},
//                {"Name":"Vanilla Ice Cream","Count":1713},
//                {"Name":"Cocoa","Count":1636},
//                {"Name":"Lettuce Salad","Count":1566},
//                {"Name":"Lobster Salad","Count":1511},
//                {"Name":"Chocolate","Count":1489},
//                {"Name":"Apple Pie","Count":1487},
//                {"Name":"Orange Juice","Count":1423},
//                {"Name":"American Cheese","Count":1372},
//                {"Name":"Green Peas","Count":1341},
//                {"Name":"Assorted Cakes","Count":1331},
//                {"Name":"French Fried Potatoes","Count":1328},
//                {"Name":"Potato Salad","Count":1306},
//                {"Name":"Baked Potatoes","Count":1293},
//                {"Name":"Roquefort","Count":1273},
//                {"Name":"Stewed Prunes","Count":1268}]
//        };
        
//        var diameter = 800;
//        var colour = d3.scaleOrdinal(d3.schemeCategory10);
//        var width=600;
//        var height = 400;
//
//        var bubble = d3.pack(dataset2)
//            .size([diameter, diameter])
//            .padding(1.5);
//
//        var svg = d3.select("body")
//            .append("svg")
//            .attr("width", diameter)
//            .attr("height", diameter)
//            .attr("class", "bubble");
//
//        var nodes = d3.hierarchy(dataset2)
//            .sum(function(d) { return d.Count; });
//
//        var div = d3.select("body").append("div")	
//            .attr("class", "tooltip")				
//            .style("opacity", 0);
//
//
//        var node = svg.selectAll(".node")
//            .data(bubble(nodes).descendants())
//            .enter()
//            .filter(function(d){
//                return  !d.children
//            })
//            .append("g")
//            .attr("class", "node")
//            .attr('transform', function(d, i) {
//                    return 'translate('+ d.x +', '+ d.y +')';
//            });
//        
//        
//        node.append("title")
//            .text(function(d) {
//                return d.data.Name + ": " + d.data.Count;
//            })
//            .attr("color","red");
//
//        node.append("circle")
//            .attr("r", function(d) {
//                return d.r;
//            })
//            .style("fill", function(d,i) {
//                return colour(i);
//            })
//
//            .on("mouseover", function(d) {		
//                div.transition()		
//                    .duration(200)		
//                    .style("opacity", .9);
//                div	.html((d.data.Name))	
//                    .style("left", (d3.event.pageX) + "px")		
//                    .style("top", (d3.event.pageY - 28) + "px");
//                })					
//            .on("mouseout", function(d) {		
//            div.transition()		
//                .duration(500)		
//                .style("opacity", 0);	
//            });
//
//        node.append("text")
//            .attr("dy", ".2em")
//            .style("text-anchor", "middle")
//            .text(function(d) {
//            return d.data.Name.substr(0,20);
//               
//            })
//            .attr("font-family", "sans-serif")
//            .attr("font-size", function(d){
//                return d.r/5;
//            })
//            .attr("fill", "white");
//
//        node.append("text")
//            .attr("dy", "1.3em")
//            .style("text-anchor", "middle")
//            .text(function(d) {
//                return d.data.Count;
//            })
//            .attr("font-family",  "Gill Sans", "Gill Sans MT")
//            .attr("font-size", function(d){
//                return d.r/5;
//            })
//            .attr("fill", "white");


   var width = 960,
    height = 500,
    padding = 1.5, // separation between same-color nodes
    clusterPadding = 6, // separation between different-color nodes
    maxRadius = 12;

var n = 200, // total number of nodes
    m = 2; // number of distinct clusters

var color = d3.scaleOrdinal(d3.schemeCategory10)
    .domain(d3.range(m));

// The largest node for each cluster.
var clusters = new Array(m);

var nodes = d3.range(n).map(function() {
  var i = Math.floor(Math.random() * m),
      r = Math.sqrt((i + 1) / m * -Math.log(Math.random())) * maxRadius,
      d = {cluster: i, radius: r};
  if (!clusters[i] || (r > clusters[i].radius)) clusters[i] = d;
  return d;
});

// Use the pack layout to initialize node positions.
d3.layout.pack()
    .sort(null)
    .size([width, height])
    .children(function(d) { return d.values; })
    .value(function(d) { return d.radius * d.radius; })
    .nodes({values: d3.nest()
      .key(function(d) { return d.cluster; })
      .entries(nodes)});

var force = d3.layout.force()
    .nodes(nodes)
    .size([width, height])
    .gravity(.02)
    .charge(0)
    .on("tick", tick)
    .start();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var node = svg.selectAll("circle")
    .data(nodes)
  .enter().append("circle")
    .style("fill", function(d) { return color(d.cluster); })
    .call(force.drag);

node.transition()
    .duration(750)
    .delay(function(d, i) { return i * 5; })
    .attrTween("r", function(d) {
      var i = d3.interpolate(0, d.radius);
      return function(t) { return d.radius = i(t); };
    });

function tick(e) {
  node
      .each(cluster(10 * e.alpha * e.alpha))
      .each(collide(.5))
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });
}

// Move d to be adjacent to the cluster node.
function cluster(alpha) {
  return function(d) {
    var cluster = clusters[d.cluster];
    if (cluster === d) return;
    var x = d.x - cluster.x,
        y = d.y - cluster.y,
        l = Math.sqrt(x * x + y * y),
        r = d.radius + cluster.radius;
    if (l != r) {
      l = (l - r) / l * alpha;
      d.x -= x *= l;
      d.y -= y *= l;
      cluster.x += x;
      cluster.y += y;
    }
  };
}

// Resolves collisions between d and all other circles.
function collide(alpha) {
  var quadtree = d3.geom.quadtree(nodes);
  return function(d) {
    var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
        nx1 = d.x - r,
        nx2 = d.x + r,
        ny1 = d.y - r,
        ny2 = d.y + r;
    quadtree.visit(function(quad, x1, y1, x2, y2) {
      if (quad.point && (quad.point !== d)) {
        var x = d.x - quad.point.x,
            y = d.y - quad.point.y,
            l = Math.sqrt(x * x + y * y),
            r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
        if (l < r) {
          l = (l - r) / l * alpha;
          d.x -= x *= l;
          d.y -= y *= l;
          quad.point.x += x;
          quad.point.y += y;
        }
      }
      return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
    });
  };
}

